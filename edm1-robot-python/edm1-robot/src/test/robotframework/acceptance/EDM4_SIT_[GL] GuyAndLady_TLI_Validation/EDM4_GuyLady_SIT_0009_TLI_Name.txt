*** Settings ***
Library           DatabaseLibrary
Resource          ../../keywords/edm.txt
Resource          ../../Repositories/${env}/${dbname}_${env}_Connection.txt

*** Test Cases ***
EDM4_GuyLady_SIT_TLI_Name_0009_0001_Validate nameID_length
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno \ where length(a.nameID) > 13;
    EDM_Compare Result    @{Result[0]}    0    nameID

EDM4_GuyLady_SIT_TLI_Name_0009_0002_Validate nameID_NotNull&NotBlank
    EDM_Connect_DB
    @{Result}    Query    select count(*) from dm.name a \ \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno \ where a.nameID = '' or a.nameID \ in ('NULL', 'Null', 'null') or a.nameID = '' or a.nameID = 'blank';
    EDM_Compare Result    @{Result[0]}    0    nameID

EDM4_GuyLady_SIT_TLI_Name_0009_0003_Validate nameIDDuplicate
    EDM_Connect_DB
    @{Result}    Query    select count(0) from (select a.nameID from dm.name a \ \ inner join dm.ordmast b on a.nameid = b.nameid \ inner join dm.tlpmigration c on c.tlipolicyno = b.policyno \ group by a.nameID having count(0) > 1) tmp
    EDM_Compare Result    @{Result[0]}    0    nameID

EDM4_GuyLady_SIT_TLI_Name_0009_0004_Validate personID_length
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno \ where length(a.personID) > 13;
    EDM_Compare Result    @{Result[0]}    0    personID

EDM4_GuyLady_SIT_TLI_Name_0009_0005_Validate personID_NotNull&NotBlank
    EDM_Connect_DB
    @{Result}    Query    select count(*) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno \ where a.personid = '' or a.personid \ in ('NULL', 'Null', 'null') or a.personid = '' or a.personid = 'blank';
    EDM_Compare Result    @{Result[0]}    0    personID

EDM4_GuyLady_SIT_TLI_Name_0009_0006_Validate preName_length
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ where length(a.preName) > 30;
    EDM_Compare Result    @{Result[0]}    0    preName

EDM4_GuyLady_SIT_TLI_Name_0009_0007_Validate preNameMapping
    [Documentation]    Run SQL Script ตรวจสอบข้อมูล "certNo"
    ...    - certNo = Auto Generate by TLI
    ...
    ...    หลัง run SQL Script ต้องแสดงค่าดังนี้
    ...    - count(*) = No row return
    EDM_Connect_DB
    ${preName}=    DatabaseLibrary.Execute Sql String    select count(0) from (select a.nameid,a.Prename from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ where a.Prename <> d.Prename except all select d.policyno,d.Prename from tlp.policymaster d join dm.tlpmigration e on d.policyno = e.tlppolicyno) tmp
    ${preName}=    Convert To String    ${preName}
    Should Be Equal    ${preName}    None

EDM4_GuyLady_SIT_TLI_Name_0009_0008_Validate firstName_length
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ where length(a.firstName) > 30;
    EDM_Compare Result    @{Result[0]}    0    firstName

EDM4_GuyLady_SIT_TLI_Name_0009_0009_Validate firstNameMapping
    [Documentation]    Run SQL Script ตรวจสอบข้อมูล "certNo"
    ...    - certNo = Auto Generate by TLI
    ...
    ...    หลัง run SQL Script ต้องแสดงค่าดังนี้
    ...    - count(*) = No row return
    EDM_Connect_DB
    ${firstName}=    DatabaseLibrary.Execute Sql String    select count(0) from (select a.nameid,a.firstName \ from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.firstName <> d.FrstName except all select d.policyno,d.FrstName from tlp.policymaster d join dm.tlpmigration e on d.policyno = e.tlppolicyno) tmp
    ${firstName}=    Convert To String    ${firstName}
    Should Be Equal    ${firstName}    None

EDM4_GuyLady_SIT_TLI_Name_0009_0010_Validate lastName_length
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where length(a.lastName) > 30;
    EDM_Compare Result    @{Result[0]}    0    lastName

EDM4_GuyLady_SIT_TLI_Name_0009_0011_Validate lastNameMapping
    [Documentation]    Run SQL Script ตรวจสอบข้อมูล "certNo"
    ...    - certNo = Auto Generate by TLI
    ...
    ...    หลัง run SQL Script ต้องแสดงค่าดังนี้
    ...    - count(*) = No row return
    EDM_Connect_DB
    ${lastName}=    DatabaseLibrary.Execute Sql String    select count(0) from (select a.nameid,a.lastName from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.lastName <> d.Surname except all select d.policyno,d.Surname from tlp.policymaster d join dm.tlpmigration e on d.policyno = e.tlppolicyno) tmp
    ${lastName}=    Convert To String    ${lastName}
    Should Be Equal    ${lastName}    None

EDM4_GuyLady_SIT_TLI_Name_0009_0012_Validate startDateMapping
    [Documentation]    Run SQL Script เพื่อตรวจสอบข้อมูล amount2
    ...    - amount2 = tlp.CustomerInfo.amount2
    ...
    ...
    ...    หลัง run SQL Script ต้องแสดงค่าดังนี้
    ...    - count (*) = 0
    EDM_Connect_DB
    @{startDate }=    query    select count(0) from (select a.nameid,a.startdate from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.startdate \ <> \ d.EffectiveDate except all select d.policyno,d.EffectiveDate from tlp.policymaster d join dm.tlpmigration e on d.policyno = e.tlppolicyno) tmp
    EDM_Compare Result    @{startDate [0]}    0    startDate

EDM4_GuyLady_SIT_TLI_Name_0009_0013_Validate startDate_NotNull&NotBlank
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.startDate = '' or a.startDate in ('NULL', 'Null', 'null') or a.startDate= '' or a.startDate= 'blank';
    EDM_Compare Result    @{Result[0]}    0    startDate

EDM4_GuyLady_SIT_TLI_Name_0009_0014_Validate startDate_Default
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ \ where a.startdate \ not between '0000-00-00' and '3000-12-31' and length(a.startdate) <> 8
    EDM_Compare Result    @{Result[0]}    0    startDate

EDM4_GuyLady_SIT_TLI_Name_0009_0015_Validate preName_NotNull&NotBlank
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.preName = '' or a.preName in ('NULL', 'Null', 'null') or a.preName= '' or a.preName= 'blank';
    EDM_Compare Result    @{Result[0]}    0    preName

EDM4_GuyLady_SIT_TLI_Name_0009_0016_Validate firstName_NotNull&NotBlank
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.firstName = '' or a.firstName in ('NULL', 'Null', 'null') or a.firstName = '' or a.firstName = 'blank';
    EDM_Compare Result    @{Result[0]}    0    firstName

EDM4_GuyLady_SIT_TLI_Name_0009_0017_Validate lastName_NotNull&NotBlank
    EDM_Connect_DB
    @{Result}    Query    select count(0) from dm.name a \ inner join dm.ordmast b on a.nameid = b.nameid inner join dm.tlpmigration c on c.tlipolicyno = b.policyno inner join tlp.policymaster d on d.policyno = c.tlppolicyno \ \ where a.lastName = '' or a.lastName in ('NULL', 'Null', 'null') or a.lastName = '' or a.lastName = 'blank';
    EDM_Compare Result    @{Result[0]}    0    lastName
