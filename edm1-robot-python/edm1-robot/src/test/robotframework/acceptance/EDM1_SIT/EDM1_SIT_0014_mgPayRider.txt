*** Settings ***
Resource          ../../keywords/edm.txt
Library           DatabaseLibrary
Resource          ../../Repositories/${env}/${dbname}_${env}_Connection.txt

*** Test Cases ***
EDM1_SIT_0014_0001_VerifyMgPayRiderColumn
    [Documentation]    ตรวจจำนวน column ที่เก็บใน Table "mgpay" มีจำนวน 26 column ดังนี้
    ...    1. certNo
    ...    2. receiveDate
    ...    3. accidentDate
    ...    4. sectionCode
    ...    5. orderNo
    ...    6. policyStatus
    ...    7. policyStatusDate
    ...    7. policyStatus2
    ...    9. policyStatusDate2
    ...    10. branchCode
    ...    11. serviceBranch
    ...    12. claimType
    ...    13. payType
    ...    14. proofInsuredAge
    ...    15. disabilityType
    ...    16. disnumber
    ...    17. payRate
    ...    18. payAmount
    ...    19. accdAmount
    ...    20. surrenderAmount
    ...    21. returnAmount
    ...    22. deductAmount
    ...    23. claimOkDate
    ...    24. claimPayDate
    ...    25. allowType
    ...    26. bookStatus
    EDM_Connect_DB
    #---- Default ----
    ${TotalColumn}    EDM_Count by query    SELECT count (c.column_name) FROM information_schema.columns c WHERE c.table_name = 'mgpayrider' AND c.table_schema = 'dm'
    Should Be Equal As Integers    ${TotalColumn}    23
    log    Column of MGOrder table is ${TotalColumn}

EDM1_SIT_0014_0002_VerifyLengthOfMgPayRiderColumn
    [Documentation]    Run SQL Script ตรวจความยาวของแต่ละ column ที่เก็บต้องไม่เกิน length ที่ระบุในเอกสาร
    ...    1. certNo = 8
    ...    2. accidentDate = 8
    ...    3. receiveDate = 8
    ...    4. sectionCode = 2
    ...    5. orderNo = 8
    ...    6. policyStatus = 1
    ...    7. policyStatusDate = 8
    ...    8. policyStatus2 = 1
    ...    9. policyStatusDate2 = 8
    ...    10. branchCode = 3
    ...    11. serviceBranch = 3
    ...    12. ameStartDate = 8
    ...    13. ameDay = 3
    ...    14. ameExpense = 9
    ...    15. amePayment = 9
    ...    16. tdDay = 3
    ...    17. tdStartDate = 8
    ...    18. tdPayment = 9
    ...    19. returnAmount = 12
    ...    20. deductAmount = 12
    ...    21. voidDate = 8
    ...    22. claimOkDate = 8
    ...    23. claimPayDate = 8
    EDM_Connect_DB
    #---- Get Total Column----
    @{columnCount}=    Query    SELECT count(a.column_name) FROM information_schema.columns a WHERE a.table_name = 'mgpayrider' AND a.data_type = 'character varying'
    ${TotalColumn}=    Convert To Integer    @{columnCount[0]}
    #----Get Column Size----
    ${lenOfColumn}=    query    SELECT a.column_name,a.character_maximum_length FROM information_schema.columns a WHERE a.table_name = 'mgpayrider' AND a.data_type = 'character varying'
    ${i}=    Set Variable    0
    : FOR    ${i}    IN RANGE    ${i}    ${TotalColumn}
    \    Log Many    ${lenOfColumn[${i}]}
    \    Exit For Loop If    '${i}' == '${TotalColumn}'

EDM1_SIT_0014_0003_VerifyCertNoMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ certNo
    ...    - certNo = auto generate by TLI โดยนำ tlp.claimRegisterHeader.RegCustomerCertificateNo ไปหาเลข CertNo ที่ gen โดย TLI สร้างขึ้นในแฟ้มหรือ method ที่ TLI สร้างขึ้น
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where (ch.regcustomercertificateno = cm.rcertno) and (mgpr.certno <> cm.certno)
    EDM_Compare Result    ${result}    0    certNo

EDM1_SIT_0014_0004_VerifyAccidentDateMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ accidentDate ดังนี้
    ...    - accidentDate = tlp.claimRegisterDetail.RegDtlDateOfOccurred
    ...    *แสดงวันที่ เป็น พศ และเอาเวลาออก
    ...
    ...    Expected Result
    ...    - 1.) ค่า accidentDate = tlp.claimRegisterDetail.RegDtlDateOfOccurred และวันที่ต้องเป็นปี พ.ศ
    ...    โดยรัน SQL Script#1: จะได้ผลลัพธ์เท่ากับ 0 Record
    ...
    ...
    ...    - 2.) ต้องไม่มีค่า \ ""00000000"" หรือ blank โดยรัน SQL Script#2: จะได้ผลลัพธ์เท่ากับ 0 Record"
    EDM_Connect_DB
    #----Script# 1----
    ${result}    EDM_Count by query    select count(0) \ from dm.mghis mgh \ join dm.mgclaim mgc on mgh.certno = mgc.certno and mgh.accidentdate = mgc.accidentdate and \ \ mgh.receivedate = mgc.receivedate and mgh.claimtype = mgc.claimtype \ join dm.certmapping cm on (cm.certno = mgc.certno) \ join tlp.claimregisterheader ch on (ch.regcustomercertificateno = cm.rcertno) \ join tlp.claimregisterdetail cd \ \ on (cd.registerseq = ch.registerseq \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4)= mgc.orderno) \ where mgh.accidentDate <> cd.RegDtlDateOfOccurred or substring(mgh.accidentDate,1,4) < '2018'
    EDM_Compare Result    ${result}    0    accidentDate
    #----Script# 2----
    ${result}    EDM_Count by query    select count(0) \ from dm.mghis mgh \ join dm.mgclaim mgc on mgh.certno = mgc.certno and mgh.accidentdate = mgc.accidentdate and \ \ mgh.receivedate = mgc.receivedate and mgh.claimtype = mgc.claimtype \ join dm.certmapping cm on (cm.certno = mgc.certno) \ join tlp.claimregisterheader ch on (ch.regcustomercertificateno = cm.rcertno) \ join tlp.claimregisterdetail cd \ \ on (cd.registerseq = ch.registerseq \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4)= mgc.orderno) \ where mgh.accidentDate = '' or \ mgh.accidentDate = '00000000'
    EDM_Compare Result    ${result}    0    accidentDate_Defualt

EDM1_SIT_0014_0005_VerifyReceiveDateMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ receiveDate ดังนี้
    ...    - receiveDate \ = tlp.claimRegisterDetail.RegDtlRegisterDate
    ...    *แสดงวันที่ เป็น พศ และเอาเวลาออก
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) \ \ \ \ \ \ \ from dm.mghis mgh \ \ \ \ \ \ \ join dm.mgclaim mgc on mgh.certno = mgc.certno and mgh.accidentdate = mgc.accidentdate and \ \ \ \ \ \ \ \ mgh.receivedate = mgc.receivedate and mgh.claimtype = mgc.claimtype \ \ \ \ \ \ \ join dm.certmapping cm on (cm.certno = mgc.certno) \ \ \ \ \ \ \ join tlp.claimregisterheader ch on (ch.regcustomercertificateno = cm.rcertno) \ \ \ \ \ \ \ join tlp.claimregisterdetail cd \ \ \ \ \ \ \ \ on (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4)= mgc.orderno) \ \ \ \ \ \ \ where mgh.receiveDate <> cd.RegDtlRegisterDate or substring(mgh.receiveDate,1,4) < '2018'
    EDM_Compare Result    ${result}    0    receiveDate

EDM1_SIT_0014_0006_VerifySectionCodeDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ sectionCode
    ...    - sectionCode = default "95"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where mgpr.sectionCode <> '95'
    EDM_Compare Result    ${result}    0    sectionCode

EDM1_SIT_0014_0007_VerifyOrderNoMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ orderNo ดังนี้
    ...    - orderNo = tlp.claimRegisterDetail.RegDtlClaimNo
    ...
    ...    โดยก่อนส่งมาให้ TLI ข้อมูลจะถูกแปลงดังนี้
    ...    1. ตัด"." และ "/" ออก
    ...    2. ย้ายปี 2 หลักสุดท้ายมาไว้ก่อนหน้าตัวอักษรภาษาอังกฤษ เช่น C.01762/16 --> 16C01762"
    ...    3. แปลงปี คศ. เป็น พศ.
    ...    4. เปลี่ยนจาก C เป็น CP
    ...    5. ตัวเลขตัดหลักแรกให้เหลือ 4 หลัก
    ...    ดังนั้น จากเดิม \ "C.01762/16" จะถูกส่งมาเป็น "60CP1762"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where mgpr.orderNo <> substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4)
    EDM_Compare Result    ${result}    0    orderNo

EDM1_SIT_0014_0008_VerifyPolicyStatus_I
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ policyStatus กรณี tlp.claimRegisterDetail.RegDtlPolicyStatus = blank หรือ "ACTIVE"
    ...    - policyStatus = "I"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where (trim(cd.RegDtlPolicyStatus) = '' and trim(mgpr.policyStatus) <> 'I') or \ \ \ \ \ \ \ (trim(cd.RegDtlPolicyStatus) = 'ACTIVE' and trim(mgpr.policyStatus) <> 'I')
    EDM_Compare Result    ${result}    0    policyStatus "I"

EDM1_SIT_0014_0009_VerifyPolicyStatus_D
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ policyStatus กรณี tlp.claimRegisterDetail.RegDtlPolicyStatus = "DEATH"
    ...    - policyStatus = "D"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where (trim(cd.RegDtlPolicyStatus) = 'DEATH' and trim(mgpr.policyStatus) <> 'D')
    EDM_Compare Result    ${result}    0    policyStatus "D"

EDM1_SIT_0014_0010_VerifyPolicyStatus_C
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ policyStatus กรณี tlp.claimRegisterDetail.RegDtlPolicyStatus = "DEATH"
    ...    - policyStatus = "C"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where (trim(cd.RegDtlPolicyStatus) = 'CANCEL' and trim(mgpr.policyStatus) <> 'C')
    EDM_Compare Result    ${result}    0    policyStatus "C"

EDM1_SIT_0014_0011_VerifyPolicyStatusDateDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ policyStatusDate กรณี policyStatus = "I"
    ...    - policyStatusDate = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.policyStatus) = 'I' and trim(mgpr.policyStatusDate) <> '00000000'
    EDM_Compare Result    ${result}    0    policyStatusDate

EDM1_SIT_0014_0012_VerifyPolicyStatusDateMappng_PolicyStatus_D
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ policyStatusDate กรณี policyStatus = "D"
    ...    - policyStatusDate = tlp.claimRegisterDetail.RegDtlDateOfOccurred
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.policyStatus) = 'D' and trim(mgpr.policyStatusDate) <> cd.RegDtlDateOfOccurred
    EDM_Compare Result    ${result}    0    policyStatusDate

EDM1_SIT_0014_0013_VerifyPolicyStatusDateMapping_PolicyStatus_C
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ policyStatusDate กรณี policyStatus = "C"
    ...    - policyStatusDate = tlp.claimRegisterDetail.RegDtlApproveDate
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.policyStatus) = 'C' and trim(mgpr.policyStatusDate) <> cd.RegDtlApproveDate
    EDM_Compare Result    ${result}    0    policyStatusDateDefault

EDM1_SIT_0014_0014_VerifyPolicyStatus2Default_Blank
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ policyStatus2
    ...    - policyStatus2 = default ค่า blank
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.policyStatus2) <> ''
    EDM_Compare Result    ${result}    0    policyStatus2

EDM1_SIT_0014_0015_VerifyPolicyStatus2Default_Zero
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ policyStatusDate2
    ...    - policyStatusDate2 = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.policyStatusDate2) <> '00000000'
    EDM_Compare Result    ${result}    0    policyStatus2_Default

EDM1_SIT_0014_0016_VerifyPolicyStatus2Default_Zero
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ policyStatusDate2
    ...    - policyStatusDate2 = default "00000000"
    log    Pending    #ทำความเข้าใจการ map ค่า branchcode กับ details หมายเลข 17
    Comment    EDM_Connect_DB
    Comment    #---- Get Total Column----
    Comment    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.policyStatusDate2) <> '00000000'
    Comment    EDM_Compare Result    ${result}    0    policyStatus2_Default

EDM1_SIT_0014_0017_VerifyServiceBranchDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ serviceBranch
    ...    - serviceBranch = default "000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.serviceBranch) <> '000'
    EDM_Compare Result    ${result}    0    serviceBranch

EDM1_SIT_0014_0018_VerifyAmeStartDateMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameStartDate กรณีวันที่ในtlp.claimRegisterDetail.RegDtlDateOfAdmission มีค่าน้อยกว่า
    ...    tlp.claimRegisterDetail.RegDtlDateOfOPD
    ...    - ameStartDate = tlp.claimRegisterDetail.RegDtlDateOfAdmission
    ...    *เลือกวันที่ที่น้อยกว่า
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where to_date(cd.RegDtlDateOfAdmission,'YYYYMMDD') < to_date(cd.RegDtlDateOfOPD,'YYYYMMDD') \ and mgpr.ameStartDate <> cd.RegDtlDateOfAdmissionwhere to_date(cd.RegDtlDateOfAdmission,'YYYYMMDD') < to_date(cd.RegDtlDateOfOPD,'YYYYMMDD') \ and mgpr.ameStartDate <> cd.RegDtlDateOfAdmission
    EDM_Compare Result    ${result}    0    ameStartDate

EDM1_SIT_0014_0019_VerifyAmeStartDateMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameStartDate กรณีวันที่ในtlp.claimRegisterDetail.RegDtlDateOfAdmission มีค่าน้อยกว่า
    ...    tlp.claimRegisterDetail.RegDtlDateOfOPD
    ...    - ameStartDate = tlp.claimRegisterDetail.RegDtlDateOfAdmission
    ...    *เลือกวันที่ที่น้อยกว่า
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where to_date(cd.RegDtlDateOfAdmission,'YYYYMMDD') > to_date(cd.RegDtlDateOfOPD,'YYYYMMDD') \ and mgpr.ameStartDate <> cd.RegDtlDateOfOPD
    EDM_Compare Result    ${result}    0    ameStartDate

EDM1_SIT_0014_0020_VerifyAmeStartDateDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameStartDate กรณี tlp.claimRegisterDetail.RegDtlDateOfAdmission = "00000000" และ
    ...    tlp.claimRegisterDetail.RegDtlDateOfOPD = "00000000"
    ...    - ameStartDate = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where \ cd.RegDtlDateOfAdmission = '00000000' and cd.RegDtlDateOfOPD = '00000000' and mgpr.ameStartDate <> '00000000'
    EDM_Compare Result    ${result}    0    ameStartDate_Default

EDM1_SIT_0014_0021_VerifyAmeStartDateDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameStartDate กรณี tlp.claimRegisterDetail.RegDtlDateOfAdmission = "00000000" และ
    ...    tlp.claimRegisterDetail.RegDtlDateOfOPD <> "00000000"
    ...    - ameStartDate = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where \ cd.RegDtlDateOfAdmission = '00000000' and cd.RegDtlDateOfOPD <> '00000000' and mgpr.ameStartDate <> '00000000'
    EDM_Compare Result    ${result}    0    ameStartDate

EDM1_SIT_0014_0022_VerifyAmeStartDateDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameStartDate กรณี tlp.claimRegisterDetail.RegDtlDateOfAdmission <> "00000000" และ
    ...    tlp.claimRegisterDetail.RegDtlDateOfOPD = "00000000"
    ...    - ameStartDate = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where \ cd.RegDtlDateOfAdmission <> '00000000' and cd.RegDtlDateOfOPD = '00000000' and mgpr.ameStartDate <> '00000000'
    EDM_Compare Result    ${result}    0    ameStartDate

EDM1_SIT_0014_0023_VerifyAmeDayMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameDay กรณีข้อมูล ameStartDate ไม่เท่ากับ "00000000" (IPD)
    ...    - ameDay = (tlp.claimRegisterDetail.RegDtlDateOfDischarge - tlp.claimRegisterDetail.RegDtlDateOfAdmission) +1
    log    Pending (ไม่มี Data ให้ Test)
    Comment    EDM_Connect_DB
    Comment    #---- Get Total Column----
    Comment    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where to_date(cd.RegDtlDateOfAdmission,'YYYYMMDD') = to_date(cd.RegDtlDateOfOPD,'YYYYMMDD') \ and mgpr.ameStartDate <> '00000000' and to_number(mgpr.ameday,'999') <> (to_date(cd.RegDtlDateOfDischarge,'YYYYMMDD') - to_date(cd.RegDtlDateOfAdmission,'YYYYMMDD'))+1
    Comment    EDM_Compare Result    ${result}    0    ameDay

EDM1_SIT_0014_0024_VerifyAmeDayDefault_1
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameDay กรณีข้อมูล ameStartDate เท่ากับ "00000000" (OPD)
    ...    - ameDay = default "1"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where mgpr.ameStartDate = '00000000' and mgpr.ameDay <> '001'
    EDM_Compare Result    ${result}    0    ameDay_Default_1

EDM1_SIT_0014_0025_VerifyAmeExpenseMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameExpense กรณีข้อมูล tlp.claimRegisterDetail.ClaimTypeSeq \ = "4" (AME)
    ...    - ameExpense = tlp.claimRegisterDetail.RegDtlTotalAmount
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd ON (cd.registerseq = ch.registerseq and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where cd.claimtypeseq = '4' \ AND mgpr.ameExpense <> replace(to_char(to_number(cd.RegDtlTotalAmount,'999999900D99'), '999999V99'),' ','0')
    EDM_Compare Result    ${result}    0    ameExpense

EDM1_SIT_0014_0026_VerifyAmeExpenseDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ ameExpense กรณีข้อมูล tlp.claimRegisterDetail.ClaimTypeSeq \ <> "4" (AME)
    ...    - ameExpense = default "0.00"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where trim(cd.ClaimTypeSeq ) <> '4' and mgpr.ameExpense <> '000000000'
    EDM_Compare Result    ${result}    0    ameExpense_Default_0.00

EDM1_SIT_0014_0027_VerifyAmePaymentMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ amePayment \ กรณีข้อมูล tlp.claimRegisterDetail.ClaimTypeSeq \ = "4" (AME)
    ...    - amePayment = ameExpense
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where cd.claimtypeseq = '4' and mgpr.ameExpense <> mgpr.amepayment
    EDM_Compare Result    ${result}    0    amePayment

EDM1_SIT_0014_0028_VerifyAmePaymentDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ amePayment \ กรณีข้อมูล tlp.claimRegisterDetail.ClaimTypeSeq \ <> "4" (AME)
    ...    - amePayment = default "0.00"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where trim(cd.ClaimTypeSeq ) <> '4' and mgpr.amePayment <> '000000000'
    EDM_Compare Result    ${result}    0    amePayment_Default_0.00

EDM1_SIT_0014_0029_VerifyTdDayDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ tdDay
    ...    - tdDay = default "000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.tdDay ) <> '000'
    EDM_Compare Result    ${result}    0    tdDay

EDM1_SIT_0014_0030_VerifyTdStartDateDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ tdStartDate
    ...    - tdStartDate = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where trim(mgpr.tdStartDate) <> '00000000'
    EDM_Compare Result    ${result}    0    tdStartDate_Default

EDM1_SIT_0014_0031_VerifyTdPaymentMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ tdPayment \ กรณีข้อมูล tlp.claimRegisterDetail.ClaimTypeSeq \ = "11" (TTD)
    ...    - tdPayment = tlp.claimRegisterDetail.RegDtlTotalAmount
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where cd.claimtypeseq = '11' AND mgpr.tdPayment <> replace(to_char(to_number(cd.RegDtlTotalAmount,'999999900D99'), '999999V99'),' ','0')
    EDM_Compare Result    ${result}    0    tdPayment

EDM1_SIT_0014_0032_VerifyTdPaymentDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ tdPayment \ กรณีข้อมูล tlp.claimRegisterDetail.ClaimTypeSeq \ <> "11" (TTD)
    ...    - tdPayment = default "0.00"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ where trim(cd.ClaimTypeSeq ) <> '11' and mgpr.tdPayment <> '000000000'
    EDM_Compare Result    ${result}    0    tdPayment_default

EDM1_SIT_0014_0033_VerifyReturnAmountMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ returnAmount กรณี tlp.claimRegisterDetail.RegDtlVoidAmount > 0.00
    ...    - returnAmount = tlp.claimRegisterDetail.RegDtlVoidAmount
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ WHERE to_number(cd.RegDtlVoidAmount ,'999999999900D99') > 0 AND mgpr.returnAmount <> replace(to_char(to_number(cd.RegDtlVoidAmount,'999999900D99'), '999999V99'),' ','0')
    EDM_Compare Result    ${result}    0    returnAmount

EDM1_SIT_0014_0034_VerifyReturnAmountMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ returnAmount กรณี tlp.claimRegisterDetail.RegDtlVoidAmount = 0.00 และ tlp.claimRegisterDetail.RegDtlAdjustPayment >= 0.00 (เป็นค่าบวก)
    ...    - returnAmount = tlp.claimRegisterDetail.RegDtlAdjustPayment
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ WHERE (to_number(cd.RegDtlVoidAmount ,'999999999900D99') = 0 and to_number(cd.RegDtlAdjustPayment,'999999999900D99') >= 0) AND mgpr.returnAmount <> replace(to_char(to_number(cd.RegDtlAdjustPayment,'999999999900D99'), '999999999V99'),' ','0')
    EDM_Compare Result    ${result}    0    returnAmount

EDM1_SIT_0014_0035_VerifyReturnAmountDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ returnAmount กรณี tlp.claimRegisterDetail.RegDtlVoidAmount = 0.00 และ tlp.claimRegisterDetail.RegDtlAdjustPayment < 0.00 (ค่าติดลบ)
    ...    - returnAmount = default "0.00"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WHERE (to_number(cd.RegDtlVoidAmount ,'999999999900D99') = 0 and to_number(cd.RegDtlAdjustPayment,'999999999900D99') < 0) and \ \ \ \ \ \ \ mgpr.returnAmount <> '000000000000'
    EDM_Compare Result    ${result}    0    returnAmount_Default

EDM1_SIT_0014_0036_VerifyDeductAmountMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ deductAmount กรณี tlp.claimRegisterDetail.RegDtlAdjustPayment < 0.00 (ค่าติดลบ)
    ...    - deductAmount = tlp.laimRegisterDetail.RegDtlAdjustPayment
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ WHERE (to_number(cd.RegDtlAdjustPayment ,'999999999900D99') < 0) AND mgpr.deductAmount <> replace(to_char(to_number(cd.RegDtlAdjustPayment,'999999900D99'), '999999V99'),' ','0')
    EDM_Compare Result    ${result}    0    deductAmount

EDM1_SIT_0014_0037_VerifyDeductAmountDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ deductAmount กรณีtlp.claimRegisterDetail.RegDtlAdjustPayment >= 0.00 (ค่าบวก)
    ...    - deductAmount = default "0.00"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where to_number(cd.RegDtlAdjustPayment,'9999999900D99') >= 0 and (mgpr.deductAmount <> '000000000000')
    EDM_Compare Result    ${result}    0    deductAmountDefault

EDM1_SIT_0014_0038_VerifyVoidDateMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ voidDate กรณี tlp.ClaimRegisterDetail.RegDtlVoidAmount > 0.00
    ...    - voidDate = tlp.claimRegisterDetail.RegDtlApproveDate
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where to_number(cd.RegDtlVoidAmount,'9999999900D99') > 0 and mgpr.voidDate <> cd.RegDtlApproveDate
    EDM_Compare Result    ${result}    0    voidDate

EDM1_SIT_0014_0039_VerifyVoidDateDefault
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ voidDate กรณี tlp.claimRegisterDetail.RegDtlVoidAmount = 0.00
    ...    - voidDate = default "00000000"
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where to_number(cd.RegDtlVoidAmount,'9999999900D99') = 0 and mgpr.voidDate <> '00000000'
    EDM_Compare Result    ${result}    0    voidDateDefault

EDM1_SIT_0014_0040_VerifyClaimOkDateMapping
    [Documentation]    Run SQL script ตรวจสอบข้อมูลในฟิลด์ \ \ claimOkDate
    ...    - claimOkDate = tlp.claimRegisterDetail.RegDtlApproveDate
    EDM_Connect_DB
    #---- Get Total Column----
    ${result}    EDM_Count by query    select count(0) from dm.mgpayrider mgpr JOIN dm.mgclaim mgc ON mgpr.certno = mgc.certno and mgpr.orderno = mgc.orderno and mgpr.sectioncode = mgc.sectioncode JOIN dm.certmapping cm ON (cm.certno = mgc.certno) \ JOIN tlp.claimregisterheader ch ON (ch.regcustomercertificateno = cm.rcertno) \ JOIN tlp.claimregisterdetail cd \ \ \ ON (cd.registerseq = ch.registerseq \ \ \ \ \ \ \ \ and substring(regdtlclaimno, 1, 2) || 'CP' || substring(regdtlclaimno, 6, 4) \ = mgpr.orderno) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ where mgpr.claimOkDate <> cd.RegDtlApproveDate
    EDM_Compare Result    ${result}    0    claimOkDate
